<!DOCTYPE html>
<html>
<head>
    <title>Hangman</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Hangman</h1>
    <div class="word"></div>
    <div class="winner"></div>
    <script type="text/javascript">
        jQuery(function() {
            var interval;
            jQuery.ajax({
                method: 'GET',
                url: '/api/status'
            }).then((data) => {
                console.log(data);
                if (data.word === null) {
                    start();
                }
            });

            var start = function() {
                jQuery.ajax({
                    method: 'GET',
                    url: '/api/start'
                }).then((data) => {
                    jQuery('.word').html(data);
                    jQuery('.winner').empty();
                    if (! interval) {
                        interval = setInterval(refresh, 100);
                    }
                });
            };

            var refresh = function() {
                jQuery.ajax({
                    method: 'GET',
                    url: '/api/status'
                }).then((data) => {
                    if (data.wonBy) {
                        finish(data.wonBy, data.solution);
                    } else {
                        jQuery('.word').html(data.word);
                    }
                });
            };

            var finish = function(wonBy, solution) {
                clearInterval(interval);
                interval = null;
                jQuery('.word').html(solution);
                jQuery('.winner').text(`Herzlichen GlÃ¼ckwunsch ${wonBy} ðŸŽ‰. Neues Spiel startet...`);
                setTimeout(start, 10000);
            }


            interval = setInterval(refresh, 100);
        });
    </script>
</body>
</html>